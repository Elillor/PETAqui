<!DOCTYPE html>
<html lang="ca">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Notícies - PETAqui</title>

    <meta
      name="description"
      content="Consulta les últimes notícies i articles sobre benestar animal, adopció responsable i consells per a mascotes a PETAqui."
    />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Halant:wght@400;600&family=Quicksand:wght@700&family=Sarala&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="css/styles-noticies.css" />
  </head>
  <body class="d-flex flex-column min-vh-100">
    <header class="main-header navbar navbar-expand-lg">
      <div class="container-fluid">
        <a class="navbar-brand" href="index.html">
          <img
            src="img/logoP_70.png"
            alt="Logo PETAqui - tornar a l'inici"
            class="logo-img"
            srcset="
              img/logoP_70.png   70w,
              img/logoP_140.png 140w,
              img/logoP_280.png 280w
            "
            sizes="(max-width: 768px) 70px,
                  (max-width: 1200px) 140px,
                  280px"
          />
        </a>

        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div
          class="collapse navbar-collapse justify-content-end"
          id="navbarNav"
        >
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Inici</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="************">Cerca Animal</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="**********">Cerca Protectoras</a>
            </li>
            <li class="nav-item">
              <a
                class="nav-link active"
                aria-current="page"
                href="noticies.html"
                >Notícies</a
              >
            </li>
            <li class="nav-item">
              <a href="login.html" class="btn btn-primary ms-lg-3 cta-login"
                >Login</a
              >
            </li>
          </ul>
        </div>
      </div>
    </header>

    <main class="container py-5 flex-grow-1">
      <h1
        class="text-general text-center mb-5 border-bottom border-accent pb-2"
      >
        Notícies i Actualitat de Benestar Animal
      </h1>

      <section id="news-container" class="row row-cols-1 row-cols-md-2 g-4">
        <div class="col-12 text-center" id="loading-message">
          <div class="spinner-border text-secondary" role="status">
            <span class="visually-hidden">Carregant notícies...</span>
          </div>
          <p class="mt-2 text-secondary">
            Carregant notícies... Si triga molt, podria ser un problema amb el
            servei RSS.
          </p>
        </div>

        <div class="col news-placeholder">
          <div class="card h-100 news-card-custom shadow-sm">
            <div class="card-body"></div>
          </div>
        </div>
        <div class="col news-placeholder">
          <div class="card h-100 news-card-custom shadow-sm">
            <div class="card-body"></div>
          </div>
        </div>
        <div class="col news-placeholder">
          <div class="card h-100 news-card-custom shadow-sm">
            <div class="card-body"></div>
          </div>
        </div>
        <div class="col news-placeholder">
          <div class="card h-100 news-card-custom shadow-sm">
            <div class="card-body"></div>
          </div>
        </div>
        <div class="col news-placeholder">
          <div class="card h-100 news-card-custom shadow-sm">
            <div class="card-body"></div>
          </div>
        </div>
        <div class="col news-placeholder">
          <div class="card h-100 news-card-custom shadow-sm">
            <div class="card-body"></div>
          </div>
        </div>
      </section>
    </main>

    <footer class="main-footer text-white text-center py-3 mt-auto">
      <div class="container">
        <p class="mb-0">
          PETAqui &copy; 2024. Tots els drets reservats.
          <span class="d-inline-block mx-2 text-claro">|</span>

          <a href="politica-privacitat.html" class="text-acento"
            >Protecció de Dades</a
          >

          <span class="d-inline-block mx-2 text-claro">|</span>

          <a href="politica-cookies.html" class="text-acento"
            >Política de Cookies</a
          >
        </p>
      </div>
    </footer>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
      crossorigin="anonymous"
    ></script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const newsContainer = document.getElementById("news-container");
        const loadingMessage = document.getElementById("loading-message");
        const placeholders = document.querySelectorAll(".news-placeholder");

        // Ocultar los placeholders
        const hidePlaceholders = () => {
          placeholders.forEach((ph) => (ph.style.display = "none"));
        };

        // URL de ejemplo para el feed RSS.
        const RSS_FEED_URL =
          "https://www.vidanimal.org.ar/categoria/noticias/feed/";
        const PROXY_URL = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(
          RSS_FEED_URL
        )}`;

        // Mostrar placeholders al inicio
        placeholders.forEach((ph) => (ph.style.visibility = "visible"));

        if (newsContainer) {
          fetch(PROXY_URL)
            .then((response) => {
              if (!response.ok) {
                throw new Error(`Error HTTP: ${response.status}`);
              }
              return response.json();
            })
            .then((data) => {
              // Limpiar el mensaje de carga y ocultar placeholders
              if (loadingMessage) {
                loadingMessage.remove();
              }
              hidePlaceholders();

              if (data.status === "ok" && data.items && data.items.length > 0) {
                // Eliminar los placeholders del DOM
                placeholders.forEach((ph) => ph.remove());

                // LÍMITE REDUCIDO PARA MAYOR VELOCIDAD DE PROCESAMIENTO
                data.items.slice(0, 5).forEach((item) => {
                  // Limitar a las 5 primeras noticias

                  // Formatear la fecha
                  const date = new Date(item.pubDate).toLocaleDateString(
                    "ca-ES",
                    {
                      year: "numeric",
                      month: "short",
                      day: "numeric",
                    }
                  );

                  // Crear la tarjeta de noticia
                  const newsCard = `
                                <div class="col">
                                    <article class="card h-100 news-card-custom shadow-sm">
                                        <div class="card-body">
                                            <h2 class="card-title text-secondary h5">${
                                              item.title
                                            }</h2>
                                            <p class="card-text small text-general">
                                                <strong class="text-acento">Font:</strong> ${
                                                  data.feed.title || "RSS"
                                                }
                                                | <strong class="text-acento">Publicat:</strong> ${date}
                                            </p>
                                            
                                            <p class="card-text">${item.content
                                              .replace(/<[^>]*>/g, "")
                                              .substring(0, 150)}...</p>
                                            
                                            <a href="${
                                              item.link
                                            }" class="btn btn-primary btn-sm mt-3 btn-card-detail-custom" target="_blank" rel="noopener noreferrer">
                                                Llegir Notícia Completa &rarr;
                                            </a>
                                        </div>
                                    </article>
                                </div>
                            `;
                  newsContainer.insertAdjacentHTML("beforeend", newsCard);
                });
              } else {
                // Si hay error o no hay datos, mostrar el mensaje y ocultar placeholders
                newsContainer.innerHTML =
                  '<div class="col-12 text-center"><p class="alert alert-warning">No s\'han pogut carregar notícies o el feed està buit.</p></div>';
              }
            })
            .catch((error) => {
              console.error("Error carregant el feed RSS:", error);
              if (loadingMessage) {
                loadingMessage.remove();
              }
              hidePlaceholders();
              newsContainer.innerHTML =
                '<div class="col-12 text-center"><p class="alert alert-danger">Error de connexió. Comprova el servei RSS o la URL del proxy.</p></div>';
            });
        }
      });
    </script>
  </body>
</html>
